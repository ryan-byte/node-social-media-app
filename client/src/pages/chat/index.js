import "../../assets/styles/chat.css"

import io from "socket.io-client";
import {useEffect, useState} from "react";

import ChatUI from "./chatUI";
import ErrorOutput from "../../components/output/ErrorOutput";

export default function Chat(){
    const [socket,setSocket] = useState(undefined);
    const [error,setError] = useState(undefined);

    useEffect(()=>{
        let userid = "6392249e96dab8f6d1d0446a"
        const newSocket = io(`?targetUserId=${userid}`);
        setSocket(newSocket);

        newSocket.on("connect",()=>{
            console.log("user connected");
        })
        newSocket.on("disconnect",()=>{
            console.log("user disconnected");
        })
        //handle errors generated by a refused connection
        newSocket.on("connect_error", (err) => {
            if (err.data){
                //show an error if there is something wrong with the cookie credentials
                console.error(err.message + ": " + err.data.details);
                setError(err.message + ": " + err.data.details);
            }else{
                console.error(err.message);
                setError(err.message);
            }
        });

        return ()=>{
            newSocket.off("connect");
            newSocket.off("disconnect");
            newSocket.close();
        }

    }, [setSocket]);

    return (
        <div>
            {error && <ErrorOutput message={error}/>}
            {socket && <ChatUI />}
        </div>
    )
}